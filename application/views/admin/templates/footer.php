  <footer class="main-footer">
    <div class="pull-right hidden-xs">
      <b>Version</b> 1.3.0
    </div>
    <strong>Copyright &copy; 2023 <a href="https://duniamu38.com" target="_blank">Duniamu38.com</a>.</strong> All rights
    reserved.
  </footer>

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Create the tabs -->
    <ul class="nav nav-tabs nav-justified control-sidebar-tabs">
      <li><a href="#control-sidebar-home-tab" data-toggle="tab"><i class="fa fa-home"></i></a></li>
      <li><a href="#control-sidebar-settings-tab" data-toggle="tab"><i class="fa fa-gears"></i></a></li>
    </ul>
    <!-- Tab panes -->
    <div class="tab-content">
      <!-- Home tab content -->
      <div class="tab-pane" id="control-sidebar-home-tab">
        <h3 class="control-sidebar-heading">Recent Activity</h3>
        <ul class="control-sidebar-menu">
          <li>
            <a href="javascript:void(0)">
              <i class="menu-icon fa fa-birthday-cake bg-red"></i>

              <div class="menu-info">
                <h4 class="control-sidebar-subheading">Langdon's Birthday</h4>

                <p>Will be 23 on April 24th</p>
              </div>
            </a>
          </li>
          <li>
            <a href="javascript:void(0)">
              <i class="menu-icon fa fa-user bg-yellow"></i>

              <div class="menu-info">
                <h4 class="control-sidebar-subheading">Frodo Updated His Profile</h4>

                <p>New phone +1(800)555-1234</p>
              </div>
            </a>
          </li>
          <li>
            <a href="javascript:void(0)">
              <i class="menu-icon fa fa-envelope-o bg-light-blue"></i>

              <div class="menu-info">
                <h4 class="control-sidebar-subheading">Nora Joined Mailing List</h4>

                <p>nora@example.com</p>
              </div>
            </a>
          </li>
          <li>
            <a href="javascript:void(0)">
              <i class="menu-icon fa fa-file-code-o bg-green"></i>

              <div class="menu-info">
                <h4 class="control-sidebar-subheading">Cron Job 254 Executed</h4>

                <p>Execution time 5 seconds</p>
              </div>
            </a>
          </li>
        </ul>
        <!-- /.control-sidebar-menu -->

        <h3 class="control-sidebar-heading">Tasks Progress</h3>
        <ul class="control-sidebar-menu">
          <li>
            <a href="javascript:void(0)">
              <h4 class="control-sidebar-subheading">
                Custom Template Design
                <span class="label label-danger pull-right">70%</span>
              </h4>

              <div class="progress progress-xxs">
                <div class="progress-bar progress-bar-danger" style="width: 70%"></div>
              </div>
            </a>
          </li>
          <li>
            <a href="javascript:void(0)">
              <h4 class="control-sidebar-subheading">
                Update Resume
                <span class="label label-success pull-right">95%</span>
              </h4>

              <div class="progress progress-xxs">
                <div class="progress-bar progress-bar-success" style="width: 95%"></div>
              </div>
            </a>
          </li>
          <li>
            <a href="javascript:void(0)">
              <h4 class="control-sidebar-subheading">
                Laravel Integration
                <span class="label label-warning pull-right">50%</span>
              </h4>

              <div class="progress progress-xxs">
                <div class="progress-bar progress-bar-warning" style="width: 50%"></div>
              </div>
            </a>
          </li>
          <li>
            <a href="javascript:void(0)">
              <h4 class="control-sidebar-subheading">
                Back End Framework
                <span class="label label-primary pull-right">68%</span>
              </h4>

              <div class="progress progress-xxs">
                <div class="progress-bar progress-bar-primary" style="width: 68%"></div>
              </div>
            </a>
          </li>
        </ul>
        <!-- /.control-sidebar-menu -->

      </div>
      <!-- /.tab-pane -->
      <!-- Stats tab content -->
      <div class="tab-pane" id="control-sidebar-stats-tab">Stats Tab Content</div>
      <!-- /.tab-pane -->
      <!-- Settings tab content -->
      <div class="tab-pane" id="control-sidebar-settings-tab">
        <form method="post">
          <h3 class="control-sidebar-heading">General Settings</h3>

          <div class="form-group">
            <label class="control-sidebar-subheading">
              Report panel usage
              <input type="checkbox" class="pull-right" checked>
            </label>

            <p>
              Some information about this general settings option
            </p>
          </div>
          <!-- /.form-group -->

          <div class="form-group">
            <label class="control-sidebar-subheading">
              Allow mail redirect
              <input type="checkbox" class="pull-right" checked>
            </label>

            <p>
              Other sets of options are available
            </p>
          </div>
          <!-- /.form-group -->

          <div class="form-group">
            <label class="control-sidebar-subheading">
              Expose author name in posts
              <input type="checkbox" class="pull-right" checked>
            </label>

            <p>
              Allow the user to show his name in blog posts
            </p>
          </div>
          <!-- /.form-group -->

          <h3 class="control-sidebar-heading">Chat Settings</h3>

          <div class="form-group">
            <label class="control-sidebar-subheading">
              Show me as online
              <input type="checkbox" class="pull-right" checked>
            </label>
          </div>
          <!-- /.form-group -->

          <div class="form-group">
            <label class="control-sidebar-subheading">
              Turn off notifications
              <input type="checkbox" class="pull-right">
            </label>
          </div>
          <!-- /.form-group -->

          <div class="form-group">
            <label class="control-sidebar-subheading">
              Delete chat history
              <a href="javascript:void(0)" class="text-red pull-right"><i class="fa fa-trash-o"></i></a>
            </label>
          </div>
          <!-- /.form-group -->
        </form>
      </div>
      <!-- /.tab-pane -->
    </div>
  </aside>
  <!-- /.control-sidebar -->
  <!-- Add the sidebar's background. This div must be placed
       immediately after the control sidebar -->
  <div class="control-sidebar-bg"></div>
</div>
<!-- ./wrapper -->

<!-- jQuery 2.2.3 -->
<script src="<?php echo base_url('assets') ?>/plugins/jQuery/jquery-2.2.3.min.js"></script>
<!-- Bootstrap 3.3.6 -->
<script src="<?php echo base_url('assets') ?>/bootstrap/js/bootstrap.min.js"></script>
<!-- DataTables -->
<script src="<?php echo base_url('assets') ?>/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="<?php echo base_url('assets') ?>/plugins/datatables/dataTables.bootstrap.min.js"></script>
<!-- SlimScroll -->
<script src="<?php echo base_url('assets') ?>/plugins/slimScroll/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="<?php echo base_url('assets') ?>/plugins/fastclick/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="<?php echo base_url('assets') ?>/dist/js/app.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="<?php echo base_url('assets') ?>/dist/js/demo.js"></script>
<!-- PACE -->
<script src="<?php echo base_url('assets') ?>/plugins/pace/pace.min.js"></script>
<!-- page script -->
<script type="text/javascript">
	// To make Pace works on Ajax calls
	$(document).ajaxStart(function() { Pace.restart(); });
    $('.ajax').click(function(){
        $.ajax({url: '#', success: function(result){
            $('.ajax-content').html('<hr>Ajax Request Completed !');
        }});
    });
</script>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<!-- Raphael.js (required for Morris.js) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.4/raphael-min.js"></script>
<!-- Morris.js charts -->
<script src="<?php echo base_url('assets') ?>/plugins/morris/morris.min.js"></script>
<script type="text/javascript">
// Variabel global untuk menyimpan instance chart
var barChart = null;

// Fungsi untuk membuat/update chart
function updateChart(chartData) {
    // Hapus chart lama jika ada
    if (barChart !== null) {
        $('#statistikChart').empty();
        barChart = null;
    }
    
    // Pastikan spinner dihapus terlebih dahulu
    $('#statistikChart').empty();
    
    // Tampilkan/sembunyikan pesan kosong
    if (chartData.length === 0) {
        $('#statistikChart').hide();
        $('#chartEmpty').show();
        return;
    } else {
        $('#statistikChart').show();
        $('#chartEmpty').hide();
    }
    
    // Pastikan Morris.js sudah dimuat
    if (typeof Morris !== 'undefined') {
        // Buat chart baru
        barChart = new Morris.Bar({
            element: 'statistikChart',
            data: chartData,
            xkey: 'y',
            ykeys: ['a'],
            labels: ['Jumlah Arsip'],
            barColors: ['#3c8dbc'],
            resize: true,
            hideHover: 'auto',
            xLabelAngle: 45,
            yLabelFormat: function(y) {
                return y.toString();
            }
        });
    } else {
        console.error('Morris.js is not loaded');
        $('#statistikChart').html('<div class="alert alert-danger">Error: Morris.js tidak dimuat</div>');
    }
}

// Inisialisasi Morris.js Bar Chart untuk statistik kategori
$(document).ready(function() {
    // Inisialisasi chart dengan data awal
    if (typeof window.statistikChartData !== 'undefined') {
        updateChart(window.statistikChartData);
    }
    
    // Handle perubahan dropdown kategori parent
    $('#selectParentKategori').on('change', function() {
        var parentId = $(this).val();
        
        // Hapus chart lama jika ada
        if (barChart !== null) {
            $('#statistikChart').empty();
            barChart = null;
        }
        
        // Tampilkan loading
        $('#statistikChart').html('<div style="text-align: center; padding: 50px;"><i class="fa fa-spinner fa-spin fa-3x"></i><br><br>Memuat data...</div>');
        $('#statistikChart').show();
        $('#chartEmpty').hide();
        
        // AJAX request untuk mengambil data baru
        $.ajax({
            url: '<?php echo base_url("admin/dashboard/getStatistikByParent"); ?>',
            type: 'POST',
            data: {
                parent_id: parentId
            },
            dataType: 'json',
            success: function(response) {
                // Pastikan spinner dihapus sebelum update chart
                $('#statistikChart').empty();
                // Update chart dengan data baru
                updateChart(response);
            },
            error: function(xhr, status, error) {
                console.error('Error loading chart data:', error);
                // Hapus spinner dan tampilkan error
                $('#statistikChart').html('<div class="alert alert-danger"><i class="fa fa-exclamation-triangle"></i> Error memuat data statistik. Silakan coba lagi.</div>');
                $('#statistikChart').show();
                $('#chartEmpty').hide();
            }
        });
    });
});
</script>
<script>
    //Notifikasi Toast dari Flashdata
    <?php 
    $flash_pesan = $this->session->flashdata('pesan');
    if(!empty($flash_pesan)):
    ?>
    $(document).ready(function() {
        const flashData = <?php echo json_encode($flash_pesan, JSON_HEX_TAG | JSON_HEX_AMP | JSON_HEX_APOS | JSON_HEX_QUOT); ?>;
        
        if (flashData && flashData.trim() !== '' && flashData !== null && flashData !== undefined){
            // Buat key unik berdasarkan URL dan timestamp saat halaman dimuat
            const currentUrl = window.location.pathname + window.location.search;
            const pageLoadTime = window.performance ? window.performance.timing.navigationStart : Date.now();
            const pageFlashKey = 'page_flash_' + currentUrl.replace(/[^a-zA-Z0-9]/g, '_') + '_' + pageLoadTime;
            
            // Cek apakah flashdata ini sudah ditampilkan di halaman ini
            const alreadyShown = sessionStorage.getItem(pageFlashKey);
            
            if (!alreadyShown) {
                // Tandai bahwa flashdata sudah ditampilkan di halaman ini
                sessionStorage.setItem(pageFlashKey, '1');
                
                // Tampilkan toast notification
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                });
                
                Toast.fire({
                    icon: 'success',
                    title: flashData
                });
            }
        }
    });
    <?php endif; ?>

    //Konfirmasi
    $('.tombol-yakin').on('click', function (e) {
      e.preventDefault();
      const href = $(this).attr('href');
      const isiData = $(this).data('isidata');
      Swal.fire({
        title: 'Apakah anda yakin?',
        text: isiData,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Ya, lanjutkan!',
        cancelButtonText: 'Batal'
      }).then((result) => {
          if (result.isConfirmed) {
            document.location.href = href;
          }
        });
    });
</script>

<script>
  $(function () {
    $("#example1").DataTable();
    $('#example2').DataTable({
      "paging": true,
      "lengthChange": false,
      "searching": false,
      "ordering": true,
      "info": true,
      "autoWidth": false
    });
  });
</script>
</body>
</html>
